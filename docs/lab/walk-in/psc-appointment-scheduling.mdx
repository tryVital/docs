---
title: "PSC Scheduling API: Errors and Features"
description: "Error handling and optional features for scheduling appointments at Patient Service Centers (PSCs)."
---

## API Endpoints

All endpoints require authentication and are prefixed with `/v3/order`:

- [`POST /v3/order/psc/appointment/availability`](/api-reference/lab-testing/psc-schedulling/appointment-psc-availability) - Get available time slots
- [`POST /v3/order/{order_id}/psc/appointment/book`](/api-reference/lab-testing/psc-schedulling/appointment-psc-booking) - Book an appointment
- [`PATCH /v3/order/{order_id}/psc/appointment/reschedule`](/api-reference/lab-testing/psc-schedulling/appointment-psc-reschedule) - Reschedule an appointment
- [`PATCH /v3/order/{order_id}/psc/appointment/cancel`](/api-reference/lab-testing/psc-schedulling/appointment-psc-cancel) - Cancel an appointment
- [`GET /v3/order/{order_id}/psc/appointment`](/api-reference/lab-testing/psc-schedulling/appointment-psc-get) - Get appointment details
- [`GET /v3/order/psc/appointment/cancellation-reasons`](/api-reference/lab-testing/psc-schedulling/appointment-psc-cancellation-reasons) - Get cancellation reasons

---

## Error Handling

### Environment Differences

⚠️ **Important**: Currently, error behavior differs between sandbox and production environments:

| Environment    | Quest Integration | Slot Conflict Behavior                        |
| -------------- | ----------------- | --------------------------------------------- |
| **Sandbox**    | Mock client       | Returns 400 (mock doesn't simulate conflicts) |
| **Production** | Real Quest API    | Returns 404 (actual Quest response)           |

**Recommendation**: For now, handle both 400 and 404 responses as potential slot-unavailability scenarios.

### Frequently Asked Questions

#### Q: Do I need to parse error messages to distinguish between different 400 errors?

**Yes.** Since multiple error types return 400 status codes, you must examine the error message content to determine the appropriate handling:

- **Time in the past**: `"This appointment slot is no longer available. Please select a new time."` → Select new slot
- **Invalid booking key**: `"Invalid booking key format"` → Fix request
- **Missing parameters**: `"radius must be provided when using zip_code"` → Fix request
- **Order state issues**: `"Order is not in a state that allows booking..."` → Contact support

HTTP status codes alone are insufficient because our API uses 400 for multiple distinct error categories that require different user experiences.

### Error Categories

#### Slot Unavailability Errors

_The user should select a different time slot_

| Status     | Error Message                                                               | When It Occurs                           | User Action                            |
| ---------- | --------------------------------------------------------------------------- | ---------------------------------------- | -------------------------------------- |
| 400        | `"This appointment slot is no longer available. Please select a new time."` | Requested time is in the past            | Select a future time slot              |
| 400 or 404 | Quest-specific error messages                                               | Slot already taken or no longer exists   | Select a different time slot           |
| 404        | `"No slots found for zip code"`                                             | No locations/slots in the area           | Try a different location or date range |
| 404        | `"No slots found. Not all PSCs support scheduling..."`                      | All locations lack scheduling capability | Use different locations                |

#### Input Validation Errors

_Fix the request parameters_

| Status | Error Message                                                 | When It Occurs                        | User Action                                     |
| ------ | ------------------------------------------------------------- | ------------------------------------- | ----------------------------------------------- |
| 400    | `"Invalid booking key format"`                                | Malformed or corrupted booking key    | Refresh availability and get a new booking key  |
| 400    | `"Location with site code {code} not found"`                  | Invalid PSC location code             | Use a valid site code from the availability API |
| 400    | `"Location with site code {code} is no longer active"`        | PSC location disabled                 | Select a different location                     |
| 400    | `"start_date must be greater or equal than the current date"` | Past date in the availability request | Use current or future date                      |
| 400    | `"site_codes or zip_code must be provided"`                   | Missing search parameters             | Provide either site codes or zip code           |
| 400    | `"radius must be provided when using zip_code"`               | Missing radius with zip code search   | Include radius parameter                        |
| 400    | `"site_codes must be less than or equal to 3"`                | Too many site codes                   | Limit to 3 site codes maximum                   |
| 404    | `"This order doesn't exist."`                                 | Invalid order ID                      | Verify order ID is correct                      |
| 404    | `"This order is not a walk-in phlebotomy order."`             | Wrong order type                      | Use the correct order type                      |

#### Order State Errors

_Order workflow or business logic issues_

| Status | Error Message                                           | When It Occurs                       | User Action                             |
| ------ | ------------------------------------------------------- | ------------------------------------ | --------------------------------------- |
| 400    | `"Order is not a walkin phlebotomy order"`              | Wrong order type for PSC booking     | Contact support                         |
| 400    | `"Order does not have a sample ID..."`                  | Order missing requisition            | Wait for requisition or contact support |
| 400    | `"Order is not in a state that allows booking..."`      | Order workflow prevents booking      | Contact support                         |
| 400    | `"Order is not in a state that allows cancelling..."`   | Order workflow prevents cancellation | Contact support                         |
| 400    | `"Order is not in a state that allows rescheduling..."` | Order workflow prevents rescheduling | Contact support                         |
| 400    | `"This order does not have a requisition..."`           | Missing requisition for appointment  | Wait or contact support                 |
| 400    | `"This lab is not supported."`                          | Order not for Quest lab              | Use a supported lab                     |

#### Appointment Management Errors

_Appointment-specific business rules_

| Status | Error Message                                         | When It Occurs                              | User Action                       |
| ------ | ----------------------------------------------------- | ------------------------------------------- | --------------------------------- |
| 400    | `"This order doesn't have an appointment yet."`       | Trying to modify a non-existent appointment | Book an appointment first         |
| 400    | `"This appointment cannot be rescheduled."`           | Appointment marked non-reschedulable        | Cancel and book a new appointment |
| 400    | `"This appointment has been cancelled or completed."` | Operating on finalized appointment          | No further action is possible     |
| 400    | `"This appointment has already been cancelled."`      | Cancelling already cancelled appointment    | No action needed                  |
| 404    | `"Appointment not found."`                            | Appointment doesn't exist                   | Verify appointment exists         |

#### Authorization Errors

_Access control issues_

| Status | Error Message        | When It Occurs                      | User Action     |
| ------ | -------------------- | ----------------------------------- | --------------- |
| 401    | Authentication error | Invalid or expired token            | Re-authenticate |
| 403    | `"Action forbidden"` | User lacks permission for the order | Contact support |

#### Service Availability Errors

_System configuration or availability_

| Status | Error Message           | When It Occurs          | User Action                  |
| ------ | ----------------------- | ----------------------- | ---------------------------- |
| 503    | `"Feature not enabled"` | PSC scheduling disabled | Contact support or try later |

### Testing Error Scenarios

#### Sandbox Testing

- Most validation errors can be tested in sandbox
- Slot conflicts cannot be reliably tested (mock client always succeeds)
- Use invalid parameters to test input validation

#### Production Testing

- Test with caution using real appointments
- Slot conflicts will return actual 404 errors from Quest
- Time-based errors can be tested with past dates

### Quest API Limitations

- **Timeout**: 15 seconds read timeout, 5 seconds connection timeout
- **Slot availability**: Real-time, can change between availability check and booking
- **Mock client**: Doesn't simulate all real-world scenarios
- **Rate limiting**: Standard Quest API rate limits apply

---

## Beta Features

<Card horizontal icon="person-digging" color="#57164A">
These features are in **closed beta**.

Interested in these features? Get in touch with your Customer Success Manager.
</Card>

### Availability Cache

Junction maintains a fast Availability Cache containing the next 21 days of availability for all locations. Each location is refreshed every 5 minutes on average.

When you set the `allow_stale` parameter on the [PSC Appointment Availability](/api-reference/lab-testing/psc-schedulling/appointment-psc-availability) endpoint, your request is fulfilled directly from the Availability Cache, provided that:

1. All requested locations have a cache hit; and
2. The cached information is reasonably fresh (less than 15 minutes old).

When a request cannot be fulfilled by the Availability Cache, it is routed directly to the PSC Appointment Provider.

#### When to use

Use `allow_stale` when you need fast response times and can tolerate slightly stale availability data—for example, when displaying initial availability options to a user before they select a specific slot.


### Idempotency Key

You can optionally include an `idempotency_key` when submitting a booking request to the [Book PSC Appointment](/api-reference/lab-testing/psc-schedulling/appointment-psc-booking) endpoint. Requests with the same idempotency key within a 14-day retention window will return the original request's response.

Note that the response is frozen at the time it is first emitted. For example, if a pending appointment later transitions to confirmed via Async Confirmation, requests with that idempotency key will still return the appointment in its original pending status.

#### When to use

Use idempotency keys to safely retry booking requests without risk of creating duplicate appointments—for example, when network issues cause uncertainty about whether a request succeeded.


### Async Confirmation

When calling the [Book PSC Appointment](/api-reference/lab-testing/psc-schedulling/appointment-psc-booking) endpoint, Junction by default returns a 500 Internal Server Error if the PSC Appointment Provider fails to acknowledge the booking request.

With Async Confirmation enabled, Junction waits synchronously for the provider to acknowledge the booking request, up to `sync_confirmation_timeout_millisecond` (default: 2.5s, range: 1–10s).

* If an acknowledgement is received before the timeout, Junction creates a _reserved_ or _confirmed_ appointment immediately and returns it in the response.

* If no acknowledgement is received before the timeout, Junction creates a placeholder **pending** appointment and returns it in the response.

#### Background retries

If a pending appointment is created, Junction continues to retry the booking request with the PSC Appointment Provider in the background, up to `async_confirmation_timeout_millisecond` (default: 15min, range: 1min–48hr).

* If an acknowledgement is received before the timeout, the appointment transitions to _reserved_ or _confirmed_ status.

* If the provider still fails to acknowledge after the timeout, the pending appointment transitions to _cancelled_ status.

#### Webhooks

You will receive the `labtest.appointment.updated` event for the initial appointment creation, as well as for all state transitions described above.

#### When to use

Use Async Confirmation when you want to provide a responsive user experience even when the PSC Appointment Provider is slow to respond. This allows you to show users a pending appointment immediately rather than waiting for a potentially slow provider response or showing an error.

---
