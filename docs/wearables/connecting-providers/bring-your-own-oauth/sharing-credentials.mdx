---
title: "Sharing Credentials"
version: "beta"
---

## Audience

This guide is dedicated to Vital customers looking to share the usage of their OAuth Client Credentials
between Vital [Bring Your Own OAuth](/wearables/connecting-providers/bring-your-own-oauth/overview) and their
existing production systems.

This guide is not applicable if you:

* do not have existing OAuth Client Credentials; or
* can configure your OAuth Client Credentials to point exclusively at Vital.


## Background

Many providers use OAuth 2.0, in which each partner entity is registered as a confidential application.
Each application is issued one set of OAuth client credentials (client ID + secret).

As a Cross-Site Request Forgery (CSRF) mitigation, they also typically require every application to pre-register
a Redirect URI. The `/authorize` flow would then validate inbound requests against the Redirect URI on record.

Most providers allow exactly one Redirect URI registration per application, which means the Redirect URI
must be one of:

* your existing OAuth callback endpoint — under a domain you control; or
* the Vital OAuth callback endpoint.

It cannot be both.

To avoid disruption to your production systems, we recommend sticking with your existing OAuth callback endpoint.

<Info>
Some providers, like Google Fit, also require domain verification. So it further restricts
the Redirect URI to point at a domain you control.
</Info>

## Challenge

Because of the Redirect URI restriction as described above, you must take some extra steps if you intend to
share your OAuth Client Credentials between Vital [Bring Your Own OAuth](/wearables/connecting-providers/bring-your-own-oauth/overview) and your
existing production systems.


## Solution

<Steps>

<Step title="Keep your current OAuth application settings">

The Redirect URI in your OAuth application settings should continue to point at your
existing OAuth callback endpoint.

</Step>

<Step title="Extend your existing OAuth callback endpoint with Vital awareness">
When Vital Link initiates an OAuth authorization request, it populates the `state` query parameter
with a specific format.

Your OAuth callback endpoints can rely on this to differentiate the request
origin — i.e., whether it is from Vital or from your own production systems.

When you detect the request is originated from Vital, please issue a 307 Temporary
Redirect to the Vital OAuth callback endpoint with **all** the URL query parameters
forwarded.

<AccordionGroup>
<Accordion title="Encoding" defaultOpen>
A JSON Web Token (JWT).
</Accordion>
<Accordion title="Claim payload schema" defaultOpen>
| Key                     | Value                                           |
| ----------------------- | ----------------------------------------------- |
| `team_id`               | Vital Team ID                                   |
| `user_id`               | Vital User ID                                   |
| `vital_link_token_id`   | Vital Link Token ID                             |
</Accordion>
<Accordion title="Example" defaultOpen>
```python Python (FastAPI)
import fastapi
from urllib.parse import urlencode

@router.get("/oauth/callback")
def handle_oauth_callback(
    request: fastapi.Request,
    state: Annotated[str, fastapi.Query()],
    ...,
) -> fastapi.Response:
    state_string = base64.b64decode(state)

    # Test if this is a JWT.
    # If so, try to extract the unverified claim payload, and see if this is
    # a Vital Link JWT.
    if (
        state_string.startswith('{"')
        and (state_parts := state_string.split(".", maxsplit=3))
        and len(state_parts) == 3
        and (unverified_claims := json.loads(state_parts[1]))
        and "vital_link_token_id" in unverified_claims
    ):
        base_url = "https://api.tryvital.io/v2/link/connect/PROVIDER"
        query = urlencode(request.query_params)

        return fastapi.RedirectResponse(f"{base_url}?{query}")


    # Not a Vital Link JWT. Fallback to existing logic
    return process_oauth_callback(...)

```
</Accordion>
</AccordionGroup>

</Step>

<Step title="Register your OAuth callback endpoint with Vital">

When you set your OAuth Client Credential through the [Set Team Custom Credentials](api-reference/org-management/team-custom-credentials/upsert-team-custom-credentials)
endpoint, you must specify a Redirect URI override that points at your your OAuth callback endpoint.

When a Redirect URI override is present, Vital uses the override value you provided to initiate the OAuth authorization flow.

</Step>

</Steps>
